{% extends "base.html" %}
{% block pwa %}
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Custom Order">
    <link rel="apple-touch-icon" href="/static/images/icon-192.png">
    <link rel="manifest" href="/static/manifest-admin.json">
{% endblock %}
{% block pwa_script %}{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>&#x1f4cb; 주문 상세</h1>
        <div class="admin-actions">
            <a href="/admin/orders" class="btn-action btn-secondary">&#x2190; 목록으로</a>
        </div>
    </div>

    <div class="order-detail-card">
        <div class="detail-section">
            <h2>주문 정보</h2>
            <table class="detail-table">
                <tr>
                    <td>주문번호</td>
                    <td><strong>{{ order.order_id }}</strong></td>
                </tr>
                <tr>
                    <td>주문일시</td>
                    <td>{{ order.created_at }}</td>
                </tr>
                <tr>
                    <td>상태</td>
                    <td>
                        <span class="status-badge status-{{ order.status }}">
                            {{ order.status }}
                        </span>
                    </td>
                </tr>
            </table>
        </div>

        <div class="detail-section">
            <h2>고객 정보</h2>
            <table class="detail-table">
                <tr>
                    <td>이름</td>
                    <td><strong>{{ order.customer_name }}</strong></td>
                </tr>
                <tr>
                    <td>연락처</td>
                    <td>{{ order.customer_phone }}</td>
                </tr>
                <tr>
                    <td>이메일</td>
                    <td>{{ order.customer_email }}</td>
                </tr>
            </table>
        </div>

        <div class="detail-section">
            <h2>제품 정보</h2>
            <table class="detail-table">
                <tr>
                    <td>크기</td>
                    <td><strong>{{ order.width }}mm × {{ order.height }}mm</strong></td>
                </tr>
                <tr>
                    <td>주문 수량</td>
                    <td><strong>{{ order.quantity }}개</strong></td>
                </tr>
                <tr>
                    <td>최소 수량</td>
                    <td>{{ order.min_quantity }}개</td>
                </tr>
                <tr>
                    <td>샘플 제작</td>
                    <td>
                        {% if order.is_sample %}
                        <span class="badge-warning">예 (+10,000원)</span>
                        {% else %}
                        <span class="badge-success">아니오</span>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>

        <div class="detail-section">
            <h2>가격 정보</h2>
            <table class="detail-table">
                <tr>
                    <td>개당 단가</td>
                    <td>{{ "{:,}".format(order.unit_price) }}원</td>
                </tr>
                <tr>
                    <td>총 금액</td>
                    <td><strong class="text-primary">{{ "{:,}".format(order.total_price) }}원</strong></td>
                </tr>
            </table>
        </div>

        {% if order.file_path %}
        <div class="detail-section">
            <h2>첨부 파일</h2>
            <div class="file-attachment">
                {% set ext = order.file_path.split('.')[-1].lower() %}
                {% if ext in ['png', 'jpg', 'jpeg', 'gif', 'bmp'] %}
                <div class="file-preview">
                    <img src="{{ order.file_path }}" alt="첨부 이미지" class="preview-image">
                </div>
                {% endif %}
                <div class="file-actions">
                    <a href="{{ order.file_path }}" target="_blank" class="btn-download">&#x1f4ce; 파일 보기</a>
                    <a href="/admin/orders/{{ order.order_id }}/file" class="btn-download btn-download-file">&#x1f4be; 다운로드</a>
                </div>
            </div>
        </div>
        {% endif %}

        {% if order.notes %}
        <div class="detail-section">
            <h2>요청사항</h2>
            <div class="notes-box">
                {{ order.notes }}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
.admin-container {
    max-width: 860px;
    margin: 0 auto;
    padding: 20px;
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #1E1E1E 0%, #2A2A2A 100%);
    padding: 24px 28px;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    border-bottom: 3px solid var(--gold-400);
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
}

.admin-header h1 {
    color: #FFFFFF;
    margin: 0;
    font-size: 20px;
    font-weight: 800;
    letter-spacing: -0.02em;
}

.admin-actions {
    display: flex;
    gap: 10px;
}

.btn-action {
    padding: 8px 16px;
    border-radius: var(--radius-sm);
    text-decoration: none;
    font-weight: 600;
    font-size: 13px;
    font-family: var(--font-main);
    border: none;
    cursor: pointer;
    white-space: nowrap;
    transition: all var(--transition-fast);
}

.btn-secondary { background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.85); }
.btn-secondary:hover { background: rgba(255,255,255,0.2); color: #fff; }

.order-detail-card {
    background: linear-gradient(180deg, #FFFFFF 0%, #FDFCF8 100%);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    padding: 32px;
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(244, 185, 0, 0.1);
    border-top: none;
}

.detail-section {
    margin-bottom: 28px;
    padding-bottom: 28px;
    border-bottom: 1px solid var(--gray-200);
}

.detail-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.detail-section h2 {
    font-size: 16px;
    color: var(--gold-500);
    margin-bottom: 16px;
    font-weight: 800;
    letter-spacing: -0.01em;
    padding-left: 12px;
    border-left: 3px solid var(--gold-400);
}

.detail-table {
    width: 100%;
}

.detail-table tr {
    border-bottom: 1px solid var(--gray-100);
    transition: background var(--transition-fast);
}

.detail-table tr:hover {
    background: var(--gold-50);
}

.detail-table td {
    padding: 12px 4px;
    font-size: 14px;
}

.detail-table td:first-child {
    width: 30%;
    color: var(--gray-600);
    font-weight: 500;
}

.detail-table td:last-child {
    color: var(--gray-800);
}

.status-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 700;
}

.status-pending {
    background: #fff3cd;
    color: #856404;
}

.status-completed {
    background: #d4edda;
    color: #155724;
}

.badge-warning {
    padding: 4px 12px;
    background: #fff3cd;
    color: #856404;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
}

.badge-success {
    padding: 4px 12px;
    background: #d4edda;
    color: #155724;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
}

.file-attachment {
    padding: 16px;
    background: var(--gray-50);
    border-radius: var(--radius-sm);
    border: 1px solid var(--gray-200);
}

.file-preview {
    margin-bottom: 16px;
    text-align: center;
}

.preview-image {
    max-width: 100%;
    max-height: 400px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--gray-200);
}

.file-actions {
    display: flex;
    gap: 12px;
}

.btn-download {
    display: inline-block;
    padding: 10px 20px;
    background: var(--gold-gradient);
    color: var(--gray-900);
    text-decoration: none;
    border-radius: var(--radius-sm);
    font-weight: 700;
    font-size: 13px;
    transition: all var(--transition-normal);
    box-shadow: 0 2px 6px rgba(244,185,0,0.15);
}

.btn-download:hover {
    box-shadow: var(--shadow-gold);
    transform: translateY(-1px);
}

.btn-download-file {
    background: #28a745;
    color: white;
    box-shadow: 0 2px 6px rgba(40,167,69,0.2);
}

.btn-download-file:hover {
    box-shadow: 0 4px 12px rgba(40,167,69,0.3);
}

.notes-box {
    padding: 16px;
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-sm);
    line-height: 1.6;
    color: var(--gray-700);
}

@media (max-width: 768px) {
    .admin-container {
        padding: 10px;
    }
    .admin-header {
        flex-direction: column;
        gap: 12px;
        padding: 16px;
        text-align: center;
    }
    .order-detail-card {
        padding: 20px;
    }
}
</style>
{% endblock %}
