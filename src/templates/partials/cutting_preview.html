<!-- 재단/인쇄 라인 미리보기 (키링 옵션 변경 시 부분 교체) -->
{% if cutting_preview_path %}
<div class="result-preview-wrap cutting-preview">
    <img src="{{ cutting_preview_path }}" alt="재단/인쇄 라인 미리보기">
    <div class="cutting-legend">
        <span class="legend-item legend-print">빨간 = 인쇄 라인</span>
        <span class="legend-item legend-cutting">검정 = 재단 라인</span>
        {% if product_type == 'keyring' %}
        <span class="legend-item legend-hole">초록 = {% if hole_type == 'internal' %}내부 타공{% else %}고리 구멍{% endif %}</span>
        {% endif %}
    </div>
</div>
{% endif %}

{% if shape_analysis %}
<div class="shape-analysis-section">
    <h4>AI 형상 분석 (재단 라인 기준)</h4>
    <div class="shape-metrics-mini">
        <div class="sm-row">
            <span class="sm-label">재단 아웃라인 길이</span>
            <span class="sm-value">{{ "{:,.1f}".format(shape_analysis.cutting_perimeter_mm|default(shape_analysis.perimeter_mm)) }} mm</span>
        </div>
        <div class="sm-row">
            <span class="sm-label">재단 면적</span>
            <span class="sm-value">{{ "{:,.1f}".format(shape_analysis.cutting_area_mm2|default(shape_analysis.area_mm2)) }} mm2</span>
        </div>
        <div class="sm-row">
            <span class="sm-label">채움률</span>
            <span class="sm-value">{{ shape_analysis.fill_pct }}%</span>
        </div>
    </div>

    <div class="complexity-mini">
        <div class="cm-header">
            <span>복잡도</span>
            <span class="cm-grade grade-{{ shape_analysis.complexity_label }}">{{ shape_analysis.complexity_label }}</span>
        </div>
        <div class="cm-bar">
            <div class="cm-fill" style="width: {{ shape_analysis.complexity_pct|int }}%"></div>
        </div>
    </div>

    <div class="shape-price-preview">
        <span class="spp-label">형상 기반 단가 (예상)</span>
        <span class="spp-value">{{ "{:,}".format(shape_analysis.unit_price) }}원</span>
    </div>
</div>
{% endif %}
